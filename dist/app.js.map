{"version":3,"sources":["../app.js"],"names":["express","require","path","morgan","userRouter","conversationRouter","messageRouter","spaceRouter","bookingRouter","categoryRouter","vehicleRouter","rateLimit","helmet","mongoSanitize","hpp","globalErrorHandler","AppError","app","session","passport","bodyParser","sanitizeHtml","use","json","limit","checkForHTMLTags","req","res","next","body","keys","Object","i","length","key","value","status","error","secret","resave","saveUninitialized","initialize","urlencoded","extended","crossOriginResourcePolicy","whitelist","process","env","NODE_ENV","limiter","max","windowMs","message","setHeader","static","join","__dirname","all","originalUrl","module","exports"],"mappings":"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","file":"app.js","sourcesContent":["const express = require('express');\nconst path = require('path');\nconst morgan = require('morgan');\nconst userRouter = require('./routes/userRoutes');\nconst conversationRouter = require('./routes/conversationRoutes');\nconst messageRouter = require('./routes/messageRoutes');\nconst spaceRouter = require('./routes/spaceRoutes');\nconst bookingRouter = require('./routes/bookingRoutes');\nconst categoryRouter = require('./routes/categoryRoutes');\nconst vehicleRouter = require('./routes/vehicleRoutes');\nconst rateLimit = require('express-rate-limit')\nconst helmet = require('helmet')\nconst mongoSanitize = require('express-mongo-sanitize')\nconst hpp = require('hpp')\nconst globalErrorHandler = require('./controllers/errorController');\nconst AppError = require('./utils/appError');\nconst app = express();\n\nconst session = require('express-session');\nconst passport = require('passport');\nconst bodyParser = require('body-parser');\nconst sanitizeHtml = require('sanitize-html');\napp.use(express.json({ limit: '10kb' }));\nfunction checkForHTMLTags(req, res, next) {\n  const { body } = req;\n  const keys = Object.keys(body);\n\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    const value = body[key];\n\n    if (typeof value === 'string' && sanitizeHtml(value) !== value) {\n      return res.status(400).json({ error: 'HTML tags are not allowed in the request body' });\n    }\n  }\n  next();\n}\napp.use(\n  session({\n    secret: 'YOUR_SESSION_SECRET',\n    resave: false,\n    saveUninitialized: false,\n  })\n);\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(checkForHTMLTags);\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(helmet({\n  crossOriginResourcePolicy: false,\n}))\napp.use(mongoSanitize())\napp.use(hpp({\n  whitelist: [\n    'duration',\n    'price'\n  ]\n}))\nif (process.env.NODE_ENV === 'development') {\n  app.use(morgan('dev'));\n}\nconst limiter = rateLimit({\n  max: 100,\n  windowMs: 60 * 60 * 100,\n  message: 'To many request from this IP now please wait for an hour!'\n})\n\napp.use((req, res, next) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');\n  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PATCH, DELETE')\n  next();\n});\n\napp.use('/uploads/chat', express.static(path.join('uploads', 'chat')));\napp.use('/uploads/space', express.static(path.join('uploads', 'space')));\napp.use('/uploads/docs', express.static(path.join('uploads', 'docs')));\napp.use('/uploads/profile', express.static(path.join('uploads', 'profile')));\napp.use('/uploads/vehicle', express.static(path.join('uploads', 'vehicle')));\napp.use('/uploads/driverProfile', express.static(path.join('uploads', 'driverProfile')));\n\napp.use('/api', limiter)\napp.use(express.json({ limit: '10kb' }));\napp.use(express.static(`${__dirname}/public`))\napp.use('/api/v1/users', userRouter);\napp.use('/api/v1/conversations', conversationRouter);\napp.use('/api/v1/messages', messageRouter);\napp.use('/api/v1/spaces', spaceRouter);\napp.use('/api/v1/bookings', bookingRouter);\napp.use('/api/v1/category', categoryRouter);\napp.use('/api/v1/vehicle', vehicleRouter);\napp.all('*', (req, res, next) => {\n  next(new AppError(`Can't find ${req.originalUrl} on this server!`, 404))\n})\napp.use(globalErrorHandler)\n// io.on(\"connection\", (socket) => {\n//   console.log(\"userConnected\");\n// socket.on(\"join\", async ({ userId }) => {\n//   let sockets = await Socket.find({ userId });\n//   if (!sockets.includes(socket.id)) {\n//     await Socket.updateOne(\n//       { userId, socketId: socket.id },\n//       { socketId: socket.id },\n//       { upsert: true }\n//     );\n//   }\n// }); \n// });\nmodule.exports = app;\n\n\n\n\n"]}